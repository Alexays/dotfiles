#!/bin/zsh
TMP=/tmp/screen.png
RES=$(xdpyinfo | grep dimensions | awk '{print $2}')
FILTER='noise=alls=10,scale=iw/6:-1,scale=iw*6:-1:flags=neighbor'
ffmpeg -y -loglevel 0 -s "$RES" -f x11grab -i $DISPLAY -vframes 1 \
       -vf "$FILTER" "$TMP"
i3lock -u -i "$TMP"
music=$(playerctl status)
if [ "$music" = "Playing" ];then
    playerctl pause
fi
amixer set Capture nocap > /dev/null
light -O
tlight=$(light)
if (( $(echo $tlight'>'10 | bc -l) ));then
    light -S 10
fi
light -I
if [ "$music" = "Playing" ];then
    playerctl play
fi
amixer set Capture cap > /dev/null
